<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üìä ‡πÅ‡∏≠‡∏õ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö-‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</title>

<style>
body {
    font-family: 'Segoe UI', Tahoma, sans-serif;
    background: #f0f2f5;
    margin: 0;
    padding: 20px;
    display: flex;
    justify-content: center;
}
.container {
    background: #fff;
    padding: 30px;
    border-radius: 12px;
    width: 100%;
    max-width: 900px;
    box-shadow: 0 6px 20px rgba(0,0,0,.1);
}
h1 {
    text-align: center;
    color: #1a73e8;
}
.summary-display {
    display: flex;
    justify-content: space-between;
    background: #e3f2fd;
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 25px;
}
.summary-box {
    flex: 1;
    text-align: center;
}
#currentBalance { font-size: 1.8em; font-weight: bold; }
#totalIncome { color: #2e7d32; font-weight: bold; }
#totalExpense { color: #c62828; font-weight: bold; }

.input-section {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    background: #f7f9fa;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 25px;
}
.input-section input,
.input-section select,
.input-section button {
    padding: 10px;
    font-size: 1em;
}
.input-section button {
    background: #4CAF50;
    color: #fff;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

table {
    width: 100%;
    border-collapse: collapse;
}
th, td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: center;
}
th { background: #eee; }

.income-row { background: #e8f5e9; color: #2e7d32; }
.expense-row { background: #fbe9e7; color: #c62828; }

.delete-btn {
    background: #f44336;
    color: #fff;
    border: none;
    padding: 5px 8px;
    border-radius: 4px;
    cursor: pointer;
}
</style>
</head>

<body>
<div class="container">

<h1>üìä ‡πÅ‡∏≠‡∏õ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö-‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h1>

<div class="summary-display">
    <div class="summary-box">
        <p>‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏ß‡∏°</p>
        <span id="totalIncome">0.00 ‡∏ö‡∏≤‡∏ó</span>
    </div>
    <div class="summary-box">
        <p>‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏ß‡∏°</p>
        <span id="totalExpense">0.00 ‡∏ö‡∏≤‡∏ó</span>
    </div>
    <div class="summary-box">
        <p>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</p>
        <span id="currentBalance">0.00 ‡∏ö‡∏≤‡∏ó</span>
    </div>
</div>

<div class="input-section">
    <select id="transactionType" onchange="updateCategoryOptions()">
        <option value="income">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</option>
        <option value="expense">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</option>
    </select>

    <select id="transactionCategory"></select>
    <input type="number" id="transactionAmount" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô">
    <input type="text" id="transactionDescription" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î">
    <button onclick="addTransaction()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
</div>

<table>
<thead>
<tr>
    <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
    <th>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th>
    <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
    <th>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th>
    <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
    <th>‡∏•‡∏ö</th>
</tr>
</thead>
<tbody id="historyTableBody">
<tr><td colspan="6">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>
</tbody>
</table>

</div>

<script>
const GOOGLE_SHEET_WEB_APP_URL =
'https://script.google.com/macros/s/AKfycbxPXbkt6_vRFn2CZN011WjwIBQ1e8x_PYekaFRJzIQZVUeflPkRVNZIFhNubtrltvzDcg/exec';

let transactions = [];

const categories = {
    income: [
        { value: 'salary', label: '‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô' },
        { value: 'other', label: '‡∏≠‡∏∑‡πà‡∏ô‡πÜ' }
    ],
    expense: [
        { value: 'food', label: '‡∏≠‡∏≤‡∏´‡∏≤‡∏£' },
        { value: 'travel', label: '‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á' },
        { value: 'other', label: '‡∏≠‡∏∑‡πà‡∏ô‡πÜ' }
    ]
};

document.addEventListener('DOMContentLoaded', () => {
    updateCategoryOptions();
    fetchHistory();
});

function formatNumber(n) {
    return Number(n).toLocaleString('th-TH', { minimumFractionDigits: 2 });
}

function updateCategoryOptions() {
    const type = transactionType.value;
    transactionCategory.innerHTML = '';
    categories[type].forEach(c => {
        const opt = document.createElement('option');
        opt.value = c.value;
        opt.textContent = c.label;
        transactionCategory.appendChild(opt);
    });
}

function updateSummary() {
    let income = 0, expense = 0;
    transactions.forEach(t => {
        if (t.type === 'income') income += Number(t.amount);
        else expense += Number(t.amount);
    });
    totalIncome.textContent = formatNumber(income) + ' ‡∏ö‡∏≤‡∏ó';
    totalExpense.textContent = formatNumber(expense) + ' ‡∏ö‡∏≤‡∏ó';
    currentBalance.textContent = formatNumber(income - expense) + ' ‡∏ö‡∏≤‡∏ó';
}

async function fetchHistory() {
    const res = await fetch(GOOGLE_SHEET_WEB_APP_URL);
    const data = await res.json();

    // ‚≠ê ‡πÅ‡∏Å‡πâ‡∏à‡∏∏‡∏î‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç
    transactions = Array.isArray(data) ? data : [];

    updateSummary();
    renderHistory();
}

async function addTransaction() {
    if (!transactionAmount.value) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô');

    const data = new URLSearchParams({
        id: Date.now(),
        dateTime: new Date().toLocaleString('th-TH'),
        type: transactionType.value,
        category: transactionCategory.value,
        description: transactionDescription.value,
        amount: transactionAmount.value
    });

    await fetch(GOOGLE_SHEET_WEB_APP_URL, {
        method: 'POST',
        body: data
    });

    transactionAmount.value = '';
    transactionDescription.value = '';
    fetchHistory();
}

async function deleteTransaction(id) {
    if (!confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö?')) return;

    const data = new URLSearchParams({
        action: 'delete',
        id
    });

    await fetch(GOOGLE_SHEET_WEB_APP_URL, {
        method: 'POST',
        body: data
    });

    fetchHistory();
}

function renderHistory() {
    historyTableBody.innerHTML = '';

    if (transactions.length === 0) {
        historyTableBody.innerHTML =
            `<tr><td colspan="6">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>`;
        return;
    }

    transactions.slice().reverse().forEach(t => {
        const tr = document.createElement('tr');
        tr.className = t.type === 'income' ? 'income-row' : 'expense-row';
        tr.innerHTML = `
            <td>${t.dateTime}</td>
            <td>${t.description}</td>
            <td>${t.type}</td>
            <td>${t.category}</td>
            <td>${formatNumber(t.amount)}</td>
            <td>
                <button class="delete-btn"
                    onclick="deleteTransaction('${t.id}')">‡∏•‡∏ö</button>
            </td>
        `;
        historyTableBody.appendChild(tr);
    });
}
</script>

</body>
</html>
