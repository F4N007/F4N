<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìä ‡πÅ‡∏≠‡∏õ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö-‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: #f0f2f5; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        #loginSection { background: #fff; padding: 40px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 100%; max-width: 380px; text-align: center; margin-top: 80px; }
        #loginSection input { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        #loginSection button { width: 100%; padding: 12px; background: #1a73e8; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold; }
        #mainApp { display: none; width: 100%; max-width: 900px; }
        .container { background: #fff; padding: 30px; border-radius: 12px; box-shadow: 0 6px 20px rgba(0,0,0,.1); }
        .summary-display { display: flex; justify-content: space-between; background: #e3f2fd; padding: 20px; border-radius: 10px; margin-bottom: 25px; }
        .summary-box { flex: 1; text-align: center; }
        #currentBalance { font-size: 1.8em; font-weight: bold; color: #1a73e8; }
        .input-section { display: flex; gap: 10px; flex-wrap: wrap; background: #f7f9fa; padding: 15px; border-radius: 8px; margin-bottom: 25px; }
        .input-section input, .input-section select, .input-section button { padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
        .input-section button { background: #4CAF50; color: #fff; border: none; cursor: pointer; font-weight: bold; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
        .income-row { background: #e8f5e9; color: #2e7d32; }
        .expense-row { background: #fbe9e7; color: #c62828; }
        .delete-btn { background: #ff5252; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; }
    </style>
</head>
<body>

<div id="loginSection">
    <h2>üîê ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>
    <input type="text" id="userInput" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô">
    <input type="password" id="passInput" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
    <button onclick="handleLogin()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
    <div id="loginError" style="color:red; margin-top:10px;"></div>
</div>

<div id="mainApp">
    <div style="width:100%; display:flex; justify-content:space-between; margin-bottom:10px;">
        <span>Smart Money Tracker</span>
        <button onclick="handleLogout()" style="background:#f44336; color:white; border:none; padding:5px 10px; border-radius:5px; cursor:pointer;">üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
    </div>
    <div class="container">
        <h1 style="text-align: center; color: #1a73e8; margin-top: 0;">üìä ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö-‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h1>
        <div class="summary-display">
            <div class="summary-box"><p>‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏ß‡∏°</p><span id="totalIncome" style="color:#2e7d32; font-weight:bold;">0.00 ‡∏ö‡∏≤‡∏ó</span></div>
            <div class="summary-box"><p>‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏ß‡∏°</p><span id="totalExpense" style="color:#c62828; font-weight:bold;">0.00 ‡∏ö‡∏≤‡∏ó</span></div>
            <div class="summary-box"><p>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</p><span id="currentBalance">0.00 ‡∏ö‡∏≤‡∏ó</span></div>
        </div>
        <div class="input-section">
            <select id="transactionType" onchange="updateCategoryOptions()">
                <option value="income">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</option>
                <option value="expense">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</option>
            </select>
            <select id="transactionCategory"></select>
            <input type="number" id="transactionAmount" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô">
            <input type="text" id="transactionDescription" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î">
            <button id="addBtn" onclick="addTransaction()">‚ûï ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        </div>
        <table>
            <thead>
                <tr><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th><th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th><th>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th><th>‡∏•‡∏ö</th></tr>
            </thead>
            <tbody id="historyTableBody">
                <tr><td colspan="6">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>
            </tbody>
        </table>
    </div>
</div>

<script>
// ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô
const AUTH_CONFIG = { username: "din", password: "1234" };
// ‡πÉ‡∏™‡πà URL ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£ Deployment ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
const GOOGLE_SHEET_URL = 'https://script.google.com/macros/s/AKfycbzsOFjSvWH63TgbBIYIUDUsgxO5Hm1iokmYfNEDe1G9YyZMgcwsXRfgIQCsJRu9yFHz9w/exec';

let transactions = [];
const categories = {
    income: [{v:'salary', l:'‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô'}, {v:'other', l:'‡∏≠‡∏∑‡πà‡∏ô‡πÜ'}],
    expense: [{v:'food', l:'‡∏≠‡∏≤‡∏´‡∏≤‡∏£'}, {v:'travel', l:'‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á'}, {v:'other', l:'‡∏≠‡∏∑‡πà‡∏ô‡πÜ'}]
};

document.addEventListener('DOMContentLoaded', () => {
    if (localStorage.getItem("isLoggedIn") === "true") showMainApp();
});

function handleLogin() {
    const user = document.getElementById('userInput').value.toLowerCase();
    const pass = document.getElementById('passInput').value;
    if (user === AUTH_CONFIG.username && pass === AUTH_CONFIG.password) {
        localStorage.setItem("isLoggedIn", "true");
        showMainApp();
    } else {
        document.getElementById('loginError').textContent = "‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!";
    }
}

function handleLogout() {
    localStorage.removeItem("isLoggedIn");
    location.reload();
}

function showMainApp() {
    document.getElementById('loginSection').style.display = 'none';
    document.getElementById('mainApp').style.display = 'block';
    updateCategoryOptions();
    fetchHistory();
}

function updateCategoryOptions() {
    const type = document.getElementById('transactionType').value;
    const catSelect = document.getElementById('transactionCategory');
    catSelect.innerHTML = categories[type].map(c => `<option value="${c.v}">${c.l}</option>`).join('');
}

async function fetchHistory() {
    try {
        const res = await fetch(GOOGLE_SHEET_URL);
        const data = await res.json();
        transactions = Array.isArray(data) ? data : [];
        renderHistory();
        updateSummary();
    } catch (e) { console.error("‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", e); }
}

async function addTransaction() {
    const amt = document.getElementById('transactionAmount');
    const desc = document.getElementById('transactionDescription');
    const btn = document.getElementById('addBtn');
    if (!amt.value) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô');

    btn.disabled = true; btn.innerText = '‚åõ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';
    
    // ‡πÄ‡∏û‡∏¥‡πà‡∏° action: 'add' ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ù‡∏±‡πà‡∏á GS ‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£
    const payload = new URLSearchParams({
        action: 'add',
        id: Date.now(),
        dateTime: new Date().toLocaleString('th-TH'),
        type: document.getElementById('transactionType').value,
        category: document.getElementById('transactionCategory').value,
        description: desc.value || '-',
        amount: amt.value
    });

    try {
        await fetch(GOOGLE_SHEET_URL, { method: 'POST', body: payload });
        amt.value = ''; desc.value = '';
        fetchHistory(); 
    } catch (e) {
        alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠');
    } finally {
        btn.disabled = false; btn.innerText = '‚ûï ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å';
    }
}

function updateSummary() {
    let inc = 0, exp = 0;
    transactions.forEach(t => {
        if (t.type === 'income') inc += Number(t.amount);
        else exp += Number(t.amount);
    });
    document.getElementById('totalIncome').innerText = inc.toLocaleString() + ' ‡∏ö‡∏≤‡∏ó';
    document.getElementById('totalExpense').innerText = exp.toLocaleString() + ' ‡∏ö‡∏≤‡∏ó';
    document.getElementById('currentBalance').innerText = (inc - exp).toLocaleString() + ' ‡∏ö‡∏≤‡∏ó';
}

function renderHistory() {
    const body = document.getElementById('historyTableBody');
    // ‡πÉ‡∏ä‡πâ Backtick (`) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ HTML ‡πÅ‡∏ö‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î
    body.innerHTML = transactions.slice().reverse().map(t => `
        <tr class="${t.type === 'income' ? 'income-row' : 'expense-row'}">
            <td>${t.dateTime}</td>
            <td>${t.description}</td>
            <td>${t.type === 'income' ? '‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö' : '‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢'}</td>
            <td>${t.category}</td>
            <td>${Number(t.amount).toLocaleString()}</td>
            <td><button class="delete-btn" onclick="deleteTransaction('${t.id}')">‡∏•‡∏ö</button></td>
        </tr>
    `).join('') || '<tr><td colspan="6">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>';
}

async function deleteTransaction(id) {
    if (!confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) return;
    const payload = new URLSearchParams({ action: 'delete', id: id });
    await fetch(GOOGLE_SHEET_URL, { method: 'POST', body: payload });
    fetchHistory();
}
</script>
</body>
</html>
