<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üìä ‡πÅ‡∏≠‡∏õ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö-‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</title>

<style>
/* ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô */
body {
    font-family: 'Segoe UI', Tahoma, sans-serif;
    background: #f0f2f5;
    margin: 0; 
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
}

/* ===== 1. ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏´‡∏ô‡πâ‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô (Login Screen) ===== */
#loginSection {
    background: #fff;
    padding: 40px;
    border-radius: 15px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    width: 100%;
    max-width: 380px;
    text-align: center;
    margin-top: 80px;
}
#loginSection h2 { color: #1a73e8; margin-top: 0; }
#loginSection input {
    width: 100%;
    padding: 12px;
    margin-bottom: 15px;
    border: 1px solid #ddd;
    border-radius: 8px;
    box-sizing: border-box;
    font-size: 16px;
}
#loginSection button {
    width: 100%;
    padding: 12px;
    background: #1a73e8;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 16px;
    font-weight: bold;
}
#loginSection button:hover { background: #1557b0; }
.err-msg { color: #d32f2f; font-size: 14px; margin-top: 10px; height: 20px; }

/* ===== 2. ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏≠‡∏õ‡∏´‡∏•‡∏±‡∏Å (Main App) ===== */
#mainApp { display: none; width: 100%; max-width: 900px; }

.container {
    background: #fff;
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 6px 20px rgba(0,0,0,.1);
}

/* ‡∏õ‡∏∏‡πà‡∏°‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏≠‡∏≤‡∏ï‡πå (Logout Button) */
.header-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}
.logout-btn {
    background: #f44336;
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
    font-weight: bold;
    transition: 0.3s;
}
.logout-btn:hover { background: #d32f2f; }

/* ‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏• */
.summary-display {
    display: flex;
    justify-content: space-between;
    background: #e3f2fd;
    padding: 20px;
    border-radius: 10px;
    margin-bottom: 25px;
}
.summary-box { flex: 1; text-align: center; }
#currentBalance { font-size: 1.8em; font-weight: bold; color: #1a73e8; }
#totalIncome { color: #2e7d32; font-weight: bold; }
#totalExpense { color: #c62828; font-weight: bold; }

/* ‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• */
.input-section {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    background: #f7f9fa;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 25px;
}
.input-section input, .input-section select, .input-section button { 
    padding: 10px; 
    font-size: 1em; 
    border: 1px solid #ddd; 
    border-radius: 5px;
}
.input-section button { 
    background: #4CAF50; 
    color: #fff; 
    border: none; 
    cursor: pointer; 
    font-weight: bold;
}

/* ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• */
table { width: 100%; border-collapse: collapse; margin-top: 10px; }
th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
th { background: #f1f1f1; }
.income-row { background: #e8f5e9; color: #2e7d32; }
.expense-row { background: #fbe9e7; color: #c62828; }
.delete-btn { background: #ff5252; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; }
</style>
</head>

<body>

<div id="loginSection">
    <h2>üîê ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>
    <input type="text" id="userInput" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô">
    <input type="password" id="passInput" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
    <button onclick="handleLogin()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
    <div id="loginError" class="err-msg"></div>
</div>

<div id="mainApp">
    <div class="header-bar">
        <span style="font-weight: bold; color: #555;">Smart Money Tracker</span>
        <button class="logout-btn" onclick="handleLogout()">üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
    </div>
    
    <div class="container">
        <h1 style="text-align: center; color: #1a73e8; margin-top: 0;">üìä ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö-‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h1>

        <div class="summary-display">
            <div class="summary-box">
                <p style="margin: 0;">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏ß‡∏°</p>
                <span id="totalIncome">0.00 ‡∏ö‡∏≤‡∏ó</span>
            </div>
            <div class="summary-box">
                <p style="margin: 0;">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏ß‡∏°</p>
                <span id="totalExpense">0.00 ‡∏ö‡∏≤‡∏ó</span>
            </div>
            <div class="summary-box">
                <p style="margin: 0;">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</p>
                <span id="currentBalance">0.00 ‡∏ö‡∏≤‡∏ó</span>
            </div>
        </div>

        <div class="input-section">
            <select id="transactionType" onchange="updateCategoryOptions()">
                <option value="income">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</option>
                <option value="expense">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</option>
            </select>
            <select id="transactionCategory"></select>
            <input type="number" id="transactionAmount" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô">
            <input type="text" id="transactionDescription" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î">
            <button onclick="addTransaction()">‚ûï ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        </div>

        <table>
            <thead>
                <tr>
                    <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                    <th>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th>
                    <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                    <th>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th>
                    <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                    <th>‡∏•‡∏ö</th>
                </tr>
            </thead>
            <tbody id="historyTableBody">
                <tr><td colspan="6">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>
            </tbody>
        </table>
    </div>
</div>

<script>
/* ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö */
const AUTH_CONFIG = {
    username: "Din",
    password: "1234"
};

const GOOGLE_SHEET_URL = 'https://script.google.com/macros/s/AKfycbxPXbkt6_vRFn2CZN011WjwIBQ1e8x_PYekaFRJzIQZVUeflPkRVNZIFhNubtrltvzDcg/exec';

let transactions = [];
const categories = {
    income: [{v:'salary', l:'‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô'}, {v:'other', l:'‡∏≠‡∏∑‡πà‡∏ô‡πÜ'}],
    expense: [{v:'food', l:'‡∏≠‡∏≤‡∏´‡∏≤‡∏£'}, {v:'travel', l:'‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á'}, {v:'other', l:'‡∏≠‡∏∑‡πà‡∏ô‡πÜ'}]
};

/* --- ‡∏£‡∏∞‡∏ö‡∏ö Authentication --- */

document.addEventListener('DOMContentLoaded', () => {
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏Ñ‡∏¢‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ‡πÑ‡∏´‡∏°
    if (localStorage.getItem("isLoggedIn") === "true") {
        showMainApp();
    }
});

function handleLogin() {
    const user = document.getElementById('userInput').value;
    const pass = document.getElementById('passInput').value;
    const errorDisplay = document.getElementById('loginError');

    if (user === AUTH_CONFIG.username && pass === AUTH_CONFIG.password) {
        localStorage.setItem("isLoggedIn", "true");
        showMainApp();
    } else {
        errorDisplay.textContent = "‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!";
    }
}

function handleLogout() {
    if (confirm("‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) {
        localStorage.removeItem("isLoggedIn");
        location.reload(); // ‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô
    }
}

function showMainApp() {
    document.getElementById('loginSection').style.display = 'none';
    document.getElementById('mainApp').style.display = 'block';
    updateCategoryOptions();
    fetchHistory();
}

/* --- ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì) --- */

function formatNumber(n) {
    return Number(n).toLocaleString('th-TH', { minimumFractionDigits: 2 });
}

function updateCategoryOptions() {
    const type = document.getElementById('transactionType').value;
    const catSelect = document.getElementById('transactionCategory');
    catSelect.innerHTML = '';
    categories[type].forEach(c => {
        const opt = document.createElement('option');
        opt.value = c.v; opt.textContent = c.l;
        catSelect.appendChild(opt);
    });
}

async function fetchHistory() {
    try {
        const res = await fetch(GOOGLE_SHEET_URL);
        const data = await res.json();
        transactions = Array.isArray(data) ? data : [];
        updateSummary();
        renderHistory();
    } catch (e) {
        console.error("Fetch Error:", e);
    }
}

function updateSummary() {
    let inc = 0, exp = 0;
    transactions.forEach(t => {
        if (t.type === 'income') inc += Number(t.amount);
        else exp += Number(t.amount);
    });
    document.getElementById('totalIncome').textContent = formatNumber(inc) + ' ‡∏ö‡∏≤‡∏ó';
    document.getElementById('totalExpense').textContent = formatNumber(exp) + ' ‡∏ö‡∏≤‡∏ó';
    document.getElementById('currentBalance').textContent = formatNumber(inc - exp) + ' ‡∏ö‡∏≤‡∏ó';
}

async function addTransaction() {
    const amt = document.getElementById('transactionAmount');
    if (!amt.value) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô');

    const payload = new URLSearchParams({
        id: Date.now(),
        dateTime: new Date().toLocaleString('th-TH'),
        type: document.getElementById('transactionType').value,
        category: document.getElementById('transactionCategory').value,
        description: document.getElementById('transactionDescription').value,
        amount: amt.value
    });

    await fetch(GOOGLE_SHEET_URL, { method: 'POST', body: payload });
    amt.value = ''; document.getElementById('transactionDescription').value = '';
    fetchHistory();
}

async function deleteTransaction(id) {
    if (!confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) return;
    const payload = new URLSearchParams({ action: 'delete', id: id });
    await fetch(GOOGLE_SHEET_URL, { method: 'POST', body: payload });
    fetchHistory();
}

function renderHistory() {
    const body = document.getElementById('historyTableBody');
    body.innerHTML = '';
    if (transactions.length === 0) {
        body.innerHTML = '<tr><td colspan="6">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>';
        return;
    }
    transactions.slice().reverse().forEach(t => {
        const tr = document.createElement('tr');
        tr.className = t.type === 'income' ? 'income-row' : 'expense-row';
        tr.innerHTML = `
            <td>${t.dateTime}</td>
            <td>${t.description}</td>
            <td>${t.type === 'income' ? '‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö' : '‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢'}</td>
            <td>${t.category}</td>
            <td>${formatNumber(t.amount)}</td>
            <td><button class="delete-btn" onclick="deleteTransaction('${t.id}')">‡∏•‡∏ö</button></td>
        `;
        body.appendChild(tr);
    });
}
</script>

</body>
</html>
